<html>
<head>
<style media="screen" type="text/css">

    body {
        margin-top: 100px;
    }

    .player {
        width: 100%;
        text-align: center
    }

    .player td{
        width: 33%;
    }

    .media_info>td {
        padding-bottom: 50px;
    }

    .file-info {
        width: 30%;
        float: left;
        color: gray;
    }

    .file-info-current {
        width: 40%;
        float: left;
    }

    .arrow-left {
        width: 0;
        height: 0;
        border-top: 30px solid transparent;
        border-bottom: 30px solid transparent;
        border-right:60px solid black;
        display: inline-block;
    }

    .arrow-right {
      width: 0;
      height: 0;
      border-top: 30px solid transparent;
      border-bottom: 30px solid transparent;
      border-left: 60px solid  black;
      display: inline-block;
    }

    .play {
        width: 0;
        height: 0;
        border-top: 30px solid transparent;
        border-bottom: 30px solid transparent;
        border-left: 60px solid  black;
        display: inline-block;
    }

    .pause {
        width: 10px;
        height: 60px;
        border-right: 25px solid black;
        border-left: 25px solid black;
        display: inline-block;
    }

    .controler {
        border: 5px solid white;
    }
    .controler:hover {
        border: 5px solid black;
    }

</style>
<script>

    function prev() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var jsonInfo = JSON.parse(this.responseText);
                update_file_info(jsonInfo);
            }
        };
        xhttp.open("GET", "/prev", true);
        xhttp.send();
    }

    function play() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var jsonInfo = JSON.parse(this.responseText);
                update_file_info(jsonInfo);
                update_play(jsonInfo);
            }
        };
        xhttp.open("GET", "/play", true);
        xhttp.send();
    }

    function next() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var jsonInfo = JSON.parse(this.responseText);
                update_file_info(jsonInfo);
            }
        };
        xhttp.open("GET", "/next", true);
        xhttp.send();
    }

    function update_status() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var jsonInfo = JSON.parse(this.responseText);
                /* Update file info */
                update_file_info(jsonInfo);
                /* Update play/pause button */
                update_play(jsonInfo);
                /* Update random button */
                update_random(jsonInfo);
                setTimeout(update_status, 1000);
            }
        };
        xhttp.open("GET", "/info", true);
        xhttp.send();
    }

    function random() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            update_random(JSON.parse(this.responseText));
            update_ant_next_info();
        };
        xhttp.open("GET", "/random", true);
        xhttp.send();
    }

    function update_random(jsonInfo) {
        if (jsonInfo.random == "true") {
            document.getElementById("random").style.backgroundColor = "gray";
        }else {
            document.getElementById("random").style.backgroundColor = "white";
        }
    }

    function update_play(jsonInfo) {
        if (jsonInfo.status == "play") {
            document.getElementById("play-button").className = "pause";
        }else {
            document.getElementById("play-button").className = "play";
        }
    }

    function update_file_info(jsonInfo) {
        /* If file has changed, update next and ant files*/
        if (jsonInfo.file.name != document.getElementById("file-name").innerHTML) {
            update_ant_next_info();
        }
        document.getElementById("file-name").innerHTML = jsonInfo.file.name;
        document.getElementById("file-artist").innerHTML = jsonInfo.file.artist;
        document.getElementById("file-album").innerHTML = jsonInfo.file.album;
    }

    function update_ant_next_info() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            var jsonInfoExtr = JSON.parse(this.responseText);
            if (jsonInfoExtr.ant_file) {
                document.getElementById("file-name-ant").innerHTML = jsonInfoExtr.ant_file.name;
                document.getElementById("file-artist-ant").innerHTML = jsonInfoExtr.ant_file.artist;
                document.getElementById("file-album-ant").innerHTML = jsonInfoExtr.ant_file.album;
            }else {
                document.getElementById("file-name-ant").innerHTML = "";
                document.getElementById("file-artist-ant").innerHTML = "";
                document.getElementById("file-album-ant").innerHTML = "";
            }
            if (jsonInfoExtr.next_file) {
                document.getElementById("file-name-next").innerHTML = jsonInfoExtr.next_file.name;
                document.getElementById("file-artist-next").innerHTML = jsonInfoExtr.next_file.artist;
                document.getElementById("file-album-next").innerHTML = jsonInfoExtr.next_file.album;
            }else {
                document.getElementById("file-name-next").innerHTML = "";
                document.getElementById("file-artist-next").innerHTML = "";
                document.getElementById("file-album-next").innerHTML = "";
            }
        };
        xhttp.open("GET", "/info-ant-next", true);
        xhttp.send();
    }

</script>
</head>
<body>
    <table class="player">
    <tr class="media_info">
            <td colspan="3">
                <div class="file-info">
                    <div><h2 style="margin-left:1%;" id="file-name-ant"></h2></div>
                    <div><h5 style="margin-left:1%;" id="file-album-ant"></h5></div>
                    <div><h3 style="margin-left:1%"; id="file-artist-ant"></h3></div>
                </div>
                <div class="file-info-current">
                    <div><h1 style="margin-left:1%;" id="file-name">*TITLE*</h1></div>
                    <div><h4 style="margin-left:1%;" id="file-album">*ALBUM*</h4></div>
                    <div><h2 style="margin-left:1%"; id="file-artist">*ARTIST*</h2></div>
                </div>
                <div class="file-info">
                    <div><h2 style="margin-left:1%;" id="file-name-next"></h2></div>
                    <div><h5 style="margin-left:1%;" id="file-album-next"></h5></div>
                    <div><h3 style="margin-left:1%"; id="file-artist-next"></h3></div>
                </div>
            </td>
        </tr>
        <tr>
            <td class="controler" onclick="prev()">
                <div class="arrow-left"></div><div class="arrow-left"></div>
            </td>
            <td class="controler" onclick="play()">
                <div id="play-button" class="play" style="margin-left:20px;"></div>
            </td>
            <td>
                <table class="player"><tr>
                    <td class="controler" onclick="next()" style="width:80%;">
                        <div class="arrow-right"></div><div class="arrow-right"></div>
                    </td>
                    <td  id="random" class="controler" onclick="random()" style="width:20%;">
                        <div>Rand</div>
                    </td>
                </tr></table>
            </td>
        </tr>
        <tr><td></td></tr>
    </table>
<script>update_status();</script>
</body>
</html>
